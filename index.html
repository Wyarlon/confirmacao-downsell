<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra Confirmada</title>
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){
        w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
        j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K3SZTP8L');</script>
    <!-- End Google Tag Manager -->

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9W9CLWXYRG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9W9CLWXYRG');
    </script>

    <!-- Facebook Pixel -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1345211853386206');
    fbq('track', 'PageView');
    </script>
</head>
<body style="font-family: Arial; text-align: center; padding-top: 100px;">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K3SZTP8L"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <h1>✅ Compra confirmada!</h1>
    <p>Obrigado por adquirir nossa oferta especial por <strong>R$19,90</strong>.</p>
    <p>Você será redirecionado automaticamente em <span id="countdown">5</span> segundos...</p>

    <script>
        // Função principal que envia todos os eventos
        function trackPurchase() {
            const urlParams = new URLSearchParams(window.location.search);
            const fbclid = urlParams.get('fbclid') || localStorage.getItem('fbclid') || '';
            
            // 1. Envia para GA4 via dataLayer
            window.dataLayer.push({
                'event': 'purchase_completed',
                'value': 19.90,
                'currency': 'BRL',
                'fbclid': fbclid,
                'offer_type': 'downsell'
            });

            // 2. Dispara Facebook Pixel
            fbq('track', 'Purchase', {
                value: 19.90,
                currency: 'BRL',
                content_ids: ['downsell_offer'],
                content_type: 'product',
                fbclid: fbclid
            });
        }

        // Redirecionamento automático
        let seconds = 5;
        const timer = setInterval(() => {
            seconds--;
            document.getElementById('countdown').textContent = seconds;
            if(seconds <= 0) {
                clearInterval(timer);
                window.location.href = "https://compra-confirmada.my.canva.site";
            }
        }, 1000);

        // Dispara os eventos imediatamente
        trackPurchase();
    </script>
</body>
</html>
